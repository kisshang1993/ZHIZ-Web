(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() : typeof define ===
        'function' && define.amd ? define(factory) : (window.slideVerifyPlug = factory());
}(this, (function () {
    'use strict';
    var SlideVerify = function (ele, opt) {
        this.$ele = $(ele);
        this.defaults = {
            initText: '请按住滑块，拖动到最右边',
            sucessText: '验证通过',
            status: 'img-icon',
            getSuccessState: function () { }
        }
        this.settings = $.extend({}, this.defaults, opt);
        this.touchX = 0;
        this.slideFinishState = false;
        this.init();
    }
    SlideVerify.prototype = {
        constructor: SlideVerify,
        init: function () {
            var _this = this;
            _this.initDom();
            _this.initStyle();
            _this.initEle();
            _this._mousedown();
            _this._mouseup();
            _this._touchstart();
            _this._touchmove();
            _this._touchend();
        },
        initDom: function () {
            var html = $('<div class="drag-progress dragProgress">' +
                '</div>' +
                '<span class="drag-btn dragBtn ' + this.settings.status + '">' +
                '<svg class="ok" t="1562652128314" class="icon" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1976" width="48" height="48"><path d="M415.839382 819.789015c-15.011902 15.013949-39.571251 15.013949-54.583153 0L11.258903 469.792713c-15.011902-15.011902-15.011902-39.570227 0-54.583153l27.258831-27.257807c15.011902-15.012925 39.571251-15.012925 54.583153 0l268.156366 268.168646c15.011902 15.011902 39.571251 15.011902 54.583153 0l515.169179-515.186576c15.013949-15.011902 39.572274-15.011902 54.584176 0l27.258831 27.258831c15.010879 15.011902 15.010879 39.574321 0 54.587246L415.839382 819.789015z" p-id="1977" fill="#7ac23c"></path></svg>' +
                '<svg class="loading" t="1562652522155" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2816" width="48" height="48"><path d="M512 981.312a469.312 469.312 0 1 0-445.824-322.24A42.688 42.688 0 1 0 147.2 632.32 384 384 0 1 1 512 896a42.688 42.688 0 1 0 0 85.312z" p-id="2817" fill="#7ac23c"></path></svg>' +          
                '</span>' +
                '<span class="fix-tips fixTips">' +
                this.settings.initText +
                '</span>' +
                '<span class="verify-msg sucMsg">' +
                this.settings.sucessText +
                '</span>');
            this.$ele.append(html);
        },
        initStyle: function () {
            if (this.settings.wrapWidth) {
                this.$ele.css({
                    'width': this.settings.wrapWidth
                })
            } else {
                this.$ele.css({
                    'width': '100%'
                })
            }
        },
        initEle: function () {
            this.slideBtn = this.$ele.find('.dragBtn');
            this.slideProEle = this.$ele.find('.dragProgress');
            this.slideSucMsgEle = this.$ele.find('.sucMsg');
            this.slideFixTipsEle = this.$ele.find('.fixTips');
            this.maxSlideWid = this.calSlideWidth();
        },
        _mousedown: function () {
            var _this = this;
            var ifThisMousedown = false;
            _this.slideBtn.on('mousedown', function (e) {
                var distenceX = e.pageX;
                e.preventDefault();
                if (_this.ifSlideRight() || _this.ifAnimated()) {
                    return false;
                }
                ifThisMousedown = true;
                $(document).mousemove(function (e) {
                    if (!ifThisMousedown) {
                        return false;
                    }
                    var curX = e.pageX - distenceX;
                    if (curX >= _this.maxSlideWid) {
                        _this.setDragBtnSty(_this.maxSlideWid);
                        _this.setDragProgressSty(_this.maxSlideWid);
                        _this.cancelMouseMove();
                        _this.slideFinishState = true;
                        if (_this.settings.getSuccessState) {
                            _this.settings.getSuccessState(_this.slideFinishState);
                        }
                        _this.successSty();
                    } else if (curX <= 0) {
                        _this.setDragBtnSty('0');
                        _this.setDragProgressSty('0');
                    } else {
                        _this.setDragBtnSty(curX);
                        _this.setDragProgressSty(curX);
                    }
                })
                $(document).mouseup(function () {
                    if (!ifThisMousedown) {
                        return false;
                    }
                    ifThisMousedown = false;
                    if (_this.ifSlideRight()) {
                        _this.cancelMouseMove();
                        return false;
                    } else {
                        _this.failAnimate();
                        _this.cancelMouseMove();
                    }
                });
            })
        },
        _mouseup: function () { },
        _touchstart: function () {
            var _this = this;
            _this.slideBtn.on('touchstart', function (e) {
                _this.touchX = e.originalEvent.targetTouches[0].pageX;
                if (_this.ifSlideRight() || _this.ifAnimated()) {
                    return false;
                }
            })
        },
        _touchmove: function () {
            var _this = this;
            _this.slideBtn.on('touchmove', function (e) {
                e.preventDefault();
                var curX = e.originalEvent.targetTouches[0].pageX - _this.touchX;
                if (curX >= _this.maxSlideWid) {
                    _this.setDragBtnSty(_this.maxSlideWid);
                    _this.setDragProgressSty(_this.maxSlideWid);
                    _this.cancelTouchmove();
                    _this.successSty();
                    _this.slideFinishState = true;
                    if (_this.settings.getSuccessState) {
                        _this.settings.getSuccessState(_this.slideFinishState);
                    }
                    _this.slideFinishState = true;
                } else if (curX <= 0) {
                    _this.setDragBtnSty('0');
                    _this.setDragProgressSty('0');
                } else {
                    _this.setDragBtnSty(curX);
                    _this.setDragProgressSty(curX);
                }
            })
        },
        _touchend: function () {
            var _this = this;
            _this.slideBtn.on('touchend', function () {
                if (_this.ifSlideRight()) {
                    _this.cancelTouchmove();
                    return false;
                } else {
                    _this.failAnimate();
                }
            })
        },
        getDragBtnWid: function () {
            return parseFloat(this.slideBtn.outerWidth());
        },
        getDragWrapWid: function () {
            return parseFloat(this.$ele.outerWidth());
        },
        calSlideWidth: function () {
            var _this = this;
            return _this.getDragWrapWid() - _this.getDragBtnWid()
        },
        ifAnimated: function () {
            return this.slideBtn.is(":animated")
        },
        getDragBtnLeft: function () {
            return parseInt(this.slideBtn.css('left'));
        },
        ifSlideRight: function () {
            var _this = this;
            if (_this.getDragBtnLeft() == _this.calSlideWidth()) {
                return true;
            } else {
                return false;
            }
        },
        setDragBtnSty: function (left) {
            this.slideBtn.css({
                'left': left
            })
        },
        setDragProgressSty: function (wid) {
            this.slideProEle.css({
                'width': wid
            })
        },
        cancelMouseMove: function () {
            $(document).off('mousemove');
        },
        cancelTouchmove: function () {
            this.slideBtn.off('touchmove');
        },
        successSty: function () {
            this.slideSucMsgEle.show();
            this.slideBtn.addClass('suc-drag-btn');
        },
        failAnimate: function () {
            this.slideBtn.animate({
                'left': '-1px'
            }, 200);
            this.slideProEle.animate({
                'width': 0
            }, 200)
        },
        resetVerify: function () {
            this.slideSucMsgEle.hide();
            this.slideBtn.removeClass('suc-drag-btn');
            this.slideFinishState = false;
            this.slideProEle.css({
                'width': 0
            });
            this.slideBtn.css({
                'left': '-1px'
            })
            this._touchmove();
        },
    }
    var slideVerify = window.slideVerifyPlug || SlideVerify;
    return slideVerify;
})));